[[!toc levels=2]]

switch to live-build hooks
==========================

live-build 3.x ships a few interesting space-saving hooks in
`share/hooks`, such as one that removes GNOME icon cache, another one
that removes compiled Python `.pyc` files, and one that removes
`/tmp/*` at the end of the `chroot_local-hooks` stage.

Once we use this version of live-build, we can remove our own
implementation of this from `config/chroot_local-hooks/98-remove_unwanted_files`.

We probably want to [[!taglink todo/wait]] for Ubuntu to actually ship
Live CDs built using live-build 3.x, before switching to it.

duplicated Linux kernel
=======================

[[!tag todo/code]]

The Linux kernel + initramfs are present twice in a Tails ISO: once in
the iso9660 filesystem, once inside the SquashFS. The former is
needed, but the latter is not.

* `config/binary_rootfs/excludes` does not work, because the excluded
  files are deleted before being copied to the binary fs.
* Something along the lines of
  (`MKSQUASHFS_OPTIONS="${MKSQUASHFS_OPTIONS} -wildcards -e
  'boot/*'"`) does not work, due to [[!debbug 594968]].

=> we need to add an option to live-build that would allow us to
opt-in for "I don't want to ship the kernels in the rootfs".

Also, the location kexec gets its kernel from must be updated, or some
other acceptable hack (symlink?) put in place.

files only needed at build time
===============================

[[!tag todo/code]]

We're currently using `chroot_local-includes` as a way to pass files
from the build host to the build chroot. As a result, released images
contain many files (mostly in `/usr/`) that are needed at build time
but useless at runtime.

live-build 3.x bind mounts (read-only) the build configuration
directory (`config`) inside the chroot (onto `/root/config`) while the
chroot hooks are running.
