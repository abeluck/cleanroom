See the [[persistence in Tails|contribute/design/persistence]] design
document.

[[!toc levels=4]]


Note that we also have [[many other ideas|todo/persistence/later]] for
further improvements.

# Implementation

Backend
-------

[[!tag todo/code todo/documentation]]

* update Debian Live *documentation* to match our changes to live-boot
* Have our code merged upstream!
* When enabled in read-only mode, avoid displaying one device icon on
  the GNOME desktop for every single persistent directory.

User interface
--------------

### bootstrap persistent storage

* test
  - automatic steps selection and sanity checks:
    * no existing container
    * existing locked container
    * existing unlocked but unmounted container
    * existing unlocked and mounted container
  - at delete step, check that persistence is disabled
    * test with persistence enabled
    * test with persistence disabled
* future (low priority) improvements:
  - make sure SD/SDHC cards are as well supported as USB
  - delete step: add warning icon / background
  - display paths as `/dev/sdb3` instead of
    `/org/freedesktop/.../sdb3` everywhere, and especially at delete
    time

### configure which bits are persistent

- umount/lock persistent volume before exiting? however, doing so
  would make it harder to run the (bootstrap and configure,
  configure again) sequence
- default window width is a tiny bit too small (maybe 10px)
- maximize window vertically
- make "Make custom directory persistent" run a file chooser dialog,
  instead of being a plain text entry widget
- sort items by category: personal data, app configuration,
  advanced; custom lines would go to advanced; advanced would be
  displayed if, and only if, at least one custom line is already in
  live.persist; else, an arrow icon allows to unroll/display it
  - add a "Reboot now" button to the dialog of the persistence
    wizard that state that you need to reboot to apply the changes

### use persistence

* it's confusing to have an drive icon labeled ".gnupg" on the
  desktop. I also have a drive icon labeled "Persistent".
* The volume TailsData shows up in the Places menu but when clicking
  on it I get "Unable to mount TailsData /dev/dm-0 is mounted". I guess
  that's no big surprise but then it should either be removed from the
  Places menu or open the folder where it is mounted
 (/live/persistent/sdb2_unlocked) if we think that makes sense.
* symlink the dotfiles directory in `$HOME` or *Places*, or document
  where it is to be found: low-priority, would be nice for 0.11
* It would be nice to have a shortcut to the /persistent folder in
  Places â†’ Persistent: low-priority, would be nice for 0.11 though.

# Documentation

[[!tag todo/documentation]]

## For users

Users must be explained:

- **how to use** Tails persistence features
- the **shortcomings** that come with using persistence in the context
  of Tails

## For developers

- document what and how to **test** when [[preparing a Tails
  release|contribute/release_process/test]]
