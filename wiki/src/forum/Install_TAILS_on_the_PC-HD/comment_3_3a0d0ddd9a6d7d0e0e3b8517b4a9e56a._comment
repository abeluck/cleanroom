[[!comment format=mdwn
 username="anonym"
 ip="127.0.0.1"
 subject="comment 3"
 date="2010-08-30T13:38:46Z"
 content="""
This is one way to install T(A)ILS to a harddrive, and it can be done either in a VM or on a real bare-metal computer. 

#Please be aware that you can seriously fuck up your anonymity/security with this setup, so it should be considered for testing purposes only.

#Note that this will require some familiarity with partitioning in a linux system, so if you don't know how to do that or how to determine which device your harddrive has, you'll have to read up on that before.

Start by booting T(A)ILS on the computer/VM containing the harddrive. One the graphical interface has started, open a terminal (e.g. gnome-terminal) and issue the following commands, in order (there could be typos):

    # become root
    sudo su

    # EDIT THE VARIABLE BELOW TO BE THE DEVICE FOR YOUR HARDDRIVE! As you can see,
    # for me it was /dev/hdc so I set ut as such:
    HD=/dev/hdc

    # partition the drive to contain a single large partition and make it bootable. 
    # Here you could optionally also create a swap partition. We don't use that
    # normally since the swap may contain sensitive data, but since you've now
    # installed amnesia to a persisten harddrive without encryption there's
    # numerous other places where sensitive data can be retrieved from so you
    # are screwed in that way no matter what.
    cfdisk $HD

    # now the partition should be ${HD}1, i.e. /dev/hdc1 in my case
    PART=${HD}1

    # format the partition
    mkfs.ext3 $PART

    # copy files
    mkdir /mnt/chroot /mnt/cd /mnt/squashfs
    mount /dev/cdrom /mnt/cd
    mount -o loop /mnt/cd/live/filesystem.squashfs /mnt/squashfs
    mount $PART /mnt/chroot
    # note that the following command will take a minute or two to complete
    cp -a /mnt/squashfs/* /mnt/chroot 
    umount /mnt/squashfs /mnt/cd

    # copy some stuff that otherwise will be broken or missing
    rm -R /mnt/chroot/home/amnesia
    cp -a /home/amnesia /mnt/chroot/home
    cp -a /etc/hostname /mnt/chroot/etc
    cp -a /etc/hosts /mnt/chroot/etc
    cp -a /etc/sudoers /mnt/chroot/etc
    cp -a /etc/X11/xorg.conf /mnt/chroot/etc/X11

    # The follow three commands might not be necessary, but you may want to setup
    # fstab in case you get trouble booting. I didn't have to when I set this up in
    # VirtualBox, but adding the following will not hurt.
    rm /mnt/chroot/etc/fstab
    echo \"proc /proc proc defaults 0 0\" >> /mnt/chroot/etc/fstab
    echo \"/dev/$PART / ext3 defaults,noatime 0 1\" >> /mnt/chroot/etc/fstab

    # if you want auto-login to X, do this
    cp -a /etc/gdm/gdm.conf /mnt/chroot/etc/gdm

    # chroot into the filesystem
    mount -t proc none /mnt/chroot/proc
    mount -o bind /dev /mnt/chroot/dev
    chroot /mnt/chroot /bin/bash

    # add the amnesia user and fix passwords
    useradd -G dialout,cdrom,floppy,audio,video,plugdev,fuse,scanner,netdev,devian-tor,powerdev -s /bin/bash amnesia
    chown -R amnesia:amnesia /home/amnesia
    passwd amnesia
    passwd root

    # fix some symlinks
    rm /etc/resolv.conf
    ln -s /etc/resolvconf/run/resolv.conf /etc/resolv.conf
    ln -s /usr/bin/Xorg /etc/X11/X

    # remove some livecd specific stuff
    apt-get remove live-helper live-initramfs user-base aufs-modules-*
    apt-get autoremove

    # Install grub. The first command (apt-get update) can be skipped, will take
    # some time since this will be done through Tor
    apt-get update 
    apt-get install grub
    apt-get clean
    mkdir /boot/grub
    update-grub
    grub-install --no-floppy ${HD}

    exit

    umount /mnt/chroot/proc /mnt/chroot/dev /mnt/chroot

#Done!
Turn off the machine, remove the T(A)ILS CD and boot to enter your new fully persistent T(A)ILS system.

"""]]
